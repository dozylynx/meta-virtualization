echo Set the fdt address to what came from the GPU, so we can edit it
fdt addr ${fdt_addr}
echo Pull the bootargs that the GPU has edited
fdt get value bootargs /chosen bootargs
echo Add some space to the fdt so we can edit it
fdt resize 0x1000
echo Add boot arguments for Xen
fdt set /chosen xen,xen-bootargs "console=dtuart dtuart=/soc/serial@7e215040 dom0_mem='@@RPI_DOM0_MEM@@' @@RPI_DEBUG_XEN_ARGS@@"
echo Add a dom0 node to chosen to put Linux boot information in
fdt mknode /chosen dom0
echo Set this for the Linux boot command
fdt set /chosen/dom0 compatible "xen,linux-zimage", "xen,multiboot-module"
echo Set the address and size for the Linux kernel so Xen can pick it up
fdt set /chosen/dom0 reg <0x00400000 0x01000000>
echo Tell Xen where PCI is
fdt set /scb/pcie@7d500000 device_type "pci"
echo Delay to allow the MMC card to be ready
sleep 1
echo Load Xen into memory
fatload mmc 0:1 0x00200000 xen
echo Load Linux kernel into memory
fatload mmc 0:1 0x00400000 Image
echo Boot Xen
booti 0x00200000 - ${fdt_addr}
